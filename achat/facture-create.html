<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nouvelle Facture Fournisseur - MultiFlex GESCOM</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;500;600;700;800;900&display=swap">
    
    <!-- Styles -->
    <link rel="stylesheet" href="./styles/achats-common.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            font-family: "Poppins", sans-serif;
        }
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        /* Tabs */
        .tabs-container {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #E5E7EB;
            background: white;
            padding: 0;
            margin-bottom: 24px;
        }

        .tab-button {
            padding: 16px 24px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6B7280;
            position: relative;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab-button:hover {
            color: #1F2937;
        }

        .tab-button.active {
            color: #263c89;
            border-bottom-color: #263c89;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #E5E7EB;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 13px;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #263c89;
            box-shadow: 0 0 0 3px rgba(38, 60, 137, 0.1);
        }

        .form-input:read-only {
            background: #F3F4F6;
        }

        .alert-warning {
            background: #FEF3C7;
            border: 1px solid #FCD34D;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            font-size: 12px;
            color: #92400E;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .alert-success {
            background: #D1FAE5;
            border: 1px solid #6EE7B7;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            font-size: 12px;
            color: #047857;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .radio-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .radio-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid #E5E7EB;
            border-radius: 999px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-pill.active {
            background: #263c89;
            color: white;
            border-color: #263c89;
        }

        .articles-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            overflow: hidden;
        }

        .articles-table th {
            background: #F3F4F6;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: #4B5563;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #E5E7EB;
        }

        .articles-table td {
            border-top: 1px solid #E5E7EB;
            padding: 12px;
            vertical-align: middle;
            background: white;
        }

        .article-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 13px;
        }

        .btn-add-line {
            background: #DBEAFE;
            color: #1E40AF;
            border: 2px dashed #3B82F6;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 16px;
            width: 100%;
            transition: all 0.2s;
        }

        .btn-add-line:hover {
            background: #BFDBFE;
        }

        .btn-remove-line {
            background: #FEE2E2;
            color: #991B1B;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
        }

        .totals-box {
            background: #F9FAFB;
            border: 2px solid #263c89;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }

        .totals-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #E5E7EB;
        }

        .totals-row:last-child {
            border-bottom: none;
            font-size: 16px;
            font-weight: 700;
            padding-top: 12px;
        }

        .totals-label {
            font-weight: 600;
            color: #6B7280;
        }

        .totals-value {
            font-weight: 700;
            color: #263c89;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #263c89;
            color: white;
        }

        .btn-primary:hover {
            background: #1a2959;
        }

        .btn-secondary {
            background: #E5E7EB;
            color: #1F2937;
        }

        .btn-secondary:hover {
            background: #D1D5DB;
        }

        .btn-success {
            background: #10B981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            padding: 20px 0;
            margin-top: 24px;
        }

        .file-upload-zone {
            border: 2px dashed #D1D5DB;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .file-upload-zone:hover {
            border-color: #263c89;
            background: #EFF6FF;
        }

        .bcf-link-card {
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .br-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .br-checkbox:hover {
            border-color: #263c89;
            background: #EFF6FF;
        }

        .br-checkbox.selected {
            border-color: #10B981;
            background: #ECFDF5;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-success {
            background: #D1FAE5;
            color: #047857;
        }

        .badge-danger {
            background: #FEE2E2;
            color: #B91C1C;
        }

        .badge-warning {
            background: #FEF3C7;
            color: #B45309;
        }

        .echeance-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body class="h-full text-gray-800">
    <div class="h-screen flex flex-col">
        <!-- Header -->
        <header class="flex h-16 bg-white shadow-sm z-50">
            <div class="w-60 bg-[#263c89] flex items-center justify-center">
                <img src="https://microfinance-ccm.com/iola/logo-blanc.png" alt="Multiflex" class="h-10">
            </div>
            
            <div class="flex-1 flex items-center justify-between px-6">
                <h1 class="text-xl font-bold text-[#1A1A1A]">Nouvelle Facture Fournisseur</h1>
                
                <div class="flex items-center gap-4">
                    <i class="fa-solid fa-bell text-[#666666] text-lg cursor-pointer"></i>
                    <div class="flex items-center cursor-pointer">
                        <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg" class="w-8 h-8 rounded-full mr-3">
                        <span class="text-[14px] text-[#1A1A1A] mr-2">Marie DJOMO</span>
                        <i class="fa-solid fa-chevron-down text-[#666666] text-sm"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-60 bg-[#263c89] text-white overflow-y-auto">
                <nav class="py-4">
                    <div class="px-4 py-2 text-[12px] font-semibold text-white/60 uppercase tracking-wider mb-2">
                        Module Achats
                    </div>
                    
                    <a href="./dashboard.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-chart-line mr-3"></i>
                        Dashboard
                    </a>

                    <a href="./fournisseurs-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-truck mr-3"></i>
                        Fournisseurs
                    </a>

                    <a href="./demandes-achat-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-file-lines mr-3"></i>
                        Demandes d'Achat
                    </a>

                    <a href="./commandes-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-shopping-cart mr-3"></i>
                        Bons de Commande
                    </a>

                    <a href="./receptions-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-box-open mr-3"></i>
                        R√©ceptions
                    </a>

                    <a href="./factures-list.html" class="block px-4 py-2 text-[14px] bg-[#152045] border-l-4 border-[#F26F21]">
                        <i class="fa-solid fa-file-invoice mr-3"></i>
                        Factures
                    </a>

                    <a href="./litiges-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-exclamation-triangle mr-3"></i>
                        Litiges Fournisseurs
                    </a>

                    <div class="px-4 py-2 text-[12px] font-semibold text-white/60 uppercase tracking-wider mt-6 mb-2">
                        Syst√®me
                    </div>

                    <a href="../index.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-home mr-3"></i>
                        Accueil
                    </a>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <div class="flex-1 overflow-auto bg-[#F8F9FA]">
                <div class="achats-container" style="max-width: 1200px;">
                    
                    <!-- Breadcrumb -->
                    <div style="padding: 24px 24px 0;">
                        <nav style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #6B7280; margin-bottom: 20px;">
                            <a href="./factures-list.html" style="color: #263c89; text-decoration: none;">
                                <i class="fa-solid fa-file-invoice"></i> Factures
                            </a>
                            <i class="fa-solid fa-chevron-right" style="font-size: 12px;"></i>
                            <span>Nouvelle facture</span>
                        </nav>
                    </div>

                    <div style="padding: 0 24px 24px;">
                        
                        <form id="facture-form">
                            
                            <!-- TABS NAVIGATION -->
                            <div class="tabs-container">
                                <button type="button" class="tab-button active" onclick="switchTab(0)">
                                    <i class="fa-solid fa-info-circle" style="margin-right: 6px;"></i>
                                    Informations
                                </button>
                                <button type="button" class="tab-button" onclick="switchTab(1)">
                                    <i class="fa-solid fa-link" style="margin-right: 6px;"></i>
                                    Documents
                                </button>
                                <button type="button" class="tab-button" onclick="switchTab(2)">
                                    <i class="fa-solid fa-list" style="margin-right: 6px;"></i>
                                    Lignes
                                </button>
                                <button type="button" class="tab-button" onclick="switchTab(3)">
                                    <i class="fa-solid fa-calculator" style="margin-right: 6px;"></i>
                                    TVA & Totaux
                                </button>
                                <button type="button" class="tab-button" onclick="switchTab(4)">
                                    <i class="fa-solid fa-paperclip" style="margin-right: 6px;"></i>
                                    Pi√®ces jointes
                                </button>
                            </div>

                            <!-- TAB 1: INFORMATIONS G√âN√âRALES -->
                            <div class="tab-content active" id="tab-0">
                                
                                <!-- MODE DE SAISIE -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-sliders"></i> MODE DE SAISIE
                                    </h3>

                                    <div class="form-group">
                                        <label class="form-label">Type de fournisseur</label>
                                        <div class="radio-group">
                                            <label class="radio-pill active" onclick="setSupplierType('external')">
                                                <input type="radio" name="supplier-type" value="external" checked style="display: none;">
                                                Fournisseur externe (Saisie manuelle)
                                            </label>
                                            <label class="radio-pill" onclick="setSupplierType('group')">
                                                <input type="radio" name="supplier-type" value="group" style="display: none;">
                                                Soci√©t√© du groupe IOLA (Import automatique)
                                            </label>
                                        </div>
                                    </div>

                                    <div id="group-section" style="display: none;">
                                        <div class="form-group">
                                            <label class="form-label">Soci√©t√© √©mettrice</label>
                                            <select class="form-select" id="issuing-company">
                                                <option value="">S√©lectionner...</option>
                                                <option value="IOLA-DIST">IOLA DISTRIBUTION</option>
                                                <option value="IOLA-SA">IOLA SA</option>
                                            </select>
                                        </div>
                                        <button type="button" class="btn btn-primary">
                                            <i class="fa-solid fa-download"></i> R√©cup√©rer facture inter-soci√©t√©s
                                        </button>
                                    </div>
                                </div>

                                <!-- IDENTIFICATION FACTURE -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-hashtag"></i> IDENTIFICATION FACTURE
                                    </h3>

                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">N¬∞ Facture Fournisseur <span style="color: #EF4444;">*</span></label>
                                            <input type="text" class="form-input" id="supplier-invoice-number" placeholder="FACT-CHEM-2024-0156" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Date Facture <span style="color: #EF4444;">*</span></label>
                                            <input type="date" class="form-input" id="invoice-date" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Date R√©ception</label>
                                            <input type="date" class="form-input" id="reception-date" readonly>
                                            <span style="font-size: 11px; color: #6B7280; margin-top: 4px; display: block;">Aujourd'hui par d√©faut</span>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Date √âch√©ance</label>
                                            <input type="date" class="form-input" id="due-date" readonly>
                                            <span style="font-size: 11px; color: #6B7280; margin-top: 4px; display: block;">Calcul√©e selon conditions</span>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Devise</label>
                                            <select class="form-select" id="currency">
                                                <option value="XAF" selected>XAF</option>
                                                <option value="EUR">EUR</option>
                                                <option value="USD">USD</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Taux de change</label>
                                            <input type="number" class="form-input" id="exchange-rate" value="1.000" step="0.001">
                                            <span style="font-size: 11px; color: #6B7280; margin-top: 4px; display: block;">Si devise ‚â† XAF</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- FOURNISSEUR -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-building"></i> FOURNISSEUR
                                    </h3>

                                    <div class="form-group">
                                        <label class="form-label">Code Fournisseur <span style="color: #EF4444;">*</span></label>
                                        <div style="display: flex; gap: 8px;">
                                            <select class="form-select" id="supplier-select" required style="flex: 1;" onchange="selectSupplier()">
                                                <option value="">S√©lectionner</option>
                                                <option value="FOU-001" selected>FOU-2024-00023 - ChemTech SARL</option>
                                                <option value="FOU-002">FOU-2024-00024 - IOLA DISTRIBUTION</option>
                                            </select>
                                            <button type="button" class="btn btn-secondary" style="padding: 10px 16px;">
                                                <i class="fa-solid fa-search"></i> Rechercher
                                            </button>
                                        </div>
                                    </div>

                                    <div style="padding: 12px; background: #F9FAFB; border-radius: 6px; font-size: 12px; margin-bottom: 16px;" id="supplier-info">
                                        <div style="margin-bottom: 6px;"><strong>Raison sociale:</strong> ChemTech SARL</div>
                                        <div style="margin-bottom: 6px;"><strong>NIU:</strong> P087201234567W</div>
                                        <div><strong>R√©gime fiscal:</strong> R√âEL (TVA 19.25%)</div>
                                    </div>

                                    <div class="alert-warning" id="certificate-alert">
                                        <i class="fa-solid fa-exclamation-triangle"></i>
                                        <div>
                                            <strong>CONTR√îLE CERTIFICAT NON-REDEVANCE</strong>
                                            <div style="margin: 8px 0;">Statut: ‚úÖ Valide jusqu'au 15/02/2024 (expire dans 15 jours)</div>
                                            <div style="margin-top: 8px; display: flex; gap: 8px;">
                                                <button type="button" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                                                    üìÑ Voir certificat
                                                </button>
                                                <button type="button" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                                                    üîÑ Demander mise √† jour
                                                </button>
                                            </div>
                                            <div style="margin-top: 8px; font-size: 11px; color: #B91C1C;">
                                                ‚õî Si montant > 100K XAF et certificat invalide = BLOCAGE
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- SOCI√âT√â ACHETEUSE -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-warehouse"></i> SOCI√âT√â ACHETEUSE
                                    </h3>

                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Soci√©t√© <span style="color: #EF4444;">*</span></label>
                                            <select class="form-select" id="company-select" required>
                                                <option value="">S√©lectionner</option>
                                                <option value="IOLA_BTP" selected>IOLA BTP - Douala</option>
                                                <option value="IOLA_SA">IOLA SA</option>
                                                <option value="IOLA_DIST">IOLA DISTRIBUTION</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Service</label>
                                            <select class="form-select" id="service-select">
                                                <option value="">S√©lectionner</option>
                                                <option value="ACHATS_PROD" selected>Achats Production</option>
                                                <option value="ACHATS_LOG">Achats Logistique</option>
                                                <option value="ACHATS_ADMIN">Achats Administration</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Site de livraison</label>
                                            <select class="form-select" id="delivery-site">
                                                <option value="">S√©lectionner</option>
                                                <option value="ENT-PRIN" selected>Entrep√¥t principal Douala</option>
                                                <option value="ENT-YDE">Entrep√¥t Yaound√©</option>
                                                <option value="SITE-PROD">Site production Kribi</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- CONDITIONS DE PAIEMENT -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-money-bill-wave"></i> CONDITIONS DE PAIEMENT
                                    </h3>

                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Conditions <span style="color: #EF4444;">*</span></label>
                                            <select class="form-select" id="payment-terms" required onchange="calculateDueDate()">
                                                <option value="">S√©lectionner</option>
                                                <option value="NET_30" selected>30 jours net</option>
                                                <option value="NET_60">60 jours net</option>
                                                <option value="NET_90">90 jours net</option>
                                                <option value="ADVANCE">Paiement d'avance</option>
                                            </select>
                                            <span style="font-size: 11px; color: #6B7280; margin-top: 4px; display: block;">
                                                H√©rit√©es du fournisseur
                                            </span>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Mode de r√®glement <span style="color: #EF4444;">*</span></label>
                                            <select class="form-select" id="payment-mode" required>
                                                <option value="">S√©lectionner</option>
                                                <option value="VIREMENT" selected>Virement bancaire</option>
                                                <option value="CHEQUE">Ch√®que</option>
                                                <option value="CASH">Esp√®ces (max 5M XAF)</option>
                                                <option value="MOBILE">Mobile Money (max 1M XAF)</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                            <input type="checkbox" id="escompte-checkbox">
                                            <span>Escompte: 2% si paiement avant le 10/02/2024</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="alert-success">
                                    <i class="fa-solid fa-info-circle"></i>
                                    <span>Une fois enregistr√©, la facture passe en mode √©dition et vous pourrez acc√©der aux autres onglets.</span>
                                </div>

                                <!-- NAVIGATION BUTTONS -->
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="cancelInvoice()">
                                        <i class="fa-solid fa-times"></i>
                                        Annuler
                                    </button>
                                    <div style="display: flex; gap: 12px;">
                                        <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                            <i class="fa-solid fa-save"></i> Enregistrer
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="saveAndNext()">
                                            Suivant
                                            <i class="fa-solid fa-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>

                            </div>

                            <!-- TAB 2: DOCUMENTS DE R√âF√âRENCE -->
                            <div class="tab-content" id="tab-1">
                                
                                <div class="alert-warning" style="margin-bottom: 20px;">
                                    <i class="fa-solid fa-info-circle"></i>
                                    <span>‚ö†Ô∏è Cet onglet n'est accessible qu'apr√®s enregistrement initial</span>
                                </div>

                                <!-- LIAISON AVEC COMMANDES -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-link"></i> LIAISON AVEC COMMANDES
                                    </h3>

                                    <div class="form-group">
                                        <label class="form-label">Mode de liaison</label>
                                        <div class="radio-group">
                                            <label class="radio-pill active" onclick="setLinkingMode('with_order')">
                                                <input type="radio" name="linking-mode" value="with_order" checked style="display: none;">
                                                Avec bon de commande (Rapprochement automatique)
                                            </label>
                                            <label class="radio-pill" onclick="setLinkingMode('without_order')">
                                                <input type="radio" name="linking-mode" value="without_order" style="display: none;">
                                                Sans bon de commande (Saisie directe)
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- S√âLECTION DES BONS DE COMMANDE -->
                                <div class="section-card" id="bcf-selection-section">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-file-invoice"></i> S√âLECTION DES BONS DE COMMANDE
                                    </h3>

                                    <div class="form-group">
                                        <label class="form-label">Bon(s) de commande <span style="color: #EF4444;">*</span></label>
                                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                            <select class="form-select" id="bcf-select-main" style="flex: 1;">
                                                <option value="">S√©lectionner un BCF</option>
                                                <option value="BCF-001" selected>BCF-2024-0089 du 22/01/2024 - 1,931,850 XAF</option>
                                                <option value="BCF-002">BCF-2024-0090 du 25/01/2024 - 450,000 XAF</option>
                                            </select>
                                            <button type="button" class="btn btn-secondary" onclick="addBCFToList()">
                                                <i class="fa-solid fa-plus"></i> Ajouter
                                            </button>
                                        </div>

                                        <div class="bcf-link-card">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                                <strong style="color: #263c89; font-size: 14px;">BCF-2024-0089 du 22/01/2024</strong>
                                                <button type="button" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px; background: #FEE2E2; color: #991B1B;">
                                                    <i class="fa-solid fa-trash"></i> Retirer
                                                </button>
                                            </div>
                                            <div style="font-size: 12px; color: #6B7280; margin-bottom: 8px;">
                                                <strong>Statut:</strong> <span class="badge badge-warning">PARTIELLEMENT R√âCEPTIONN√â</span>
                                            </div>
                                            <div style="font-size: 12px; color: #6B7280; margin-bottom: 12px;">
                                                <strong>Montant BCF:</strong> 1,931,850 XAF | 
                                                <strong>Factur√© √† date:</strong> 0 XAF | 
                                                <strong>Reste √† facturer:</strong> 100%
                                            </div>
                                        </div>

                                        <div style="margin-top: 12px; padding: 12px; background: #EFF6FF; border: 1px solid #BFDBFE; border-radius: 6px; font-size: 12px;">
                                            <strong>BCF s√©lectionn√©s:</strong>
                                            <ul style="margin: 8px 0 0 20px;">
                                                <li>BCF-2024-0089 - ChemTech - 1,931,850 XAF</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <button type="button" class="btn btn-secondary" style="margin-top: 12px;">
                                        <i class="fa-solid fa-plus"></i> Ajouter un autre BCF (si facture multi-commandes)
                                    </button>
                                </div>

                                <!-- S√âLECTION DES BONS DE R√âCEPTION -->
                                <div class="section-card" id="br-selection-section">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-box-open"></i> S√âLECTION DES BONS DE R√âCEPTION
                                    </h3>

                                    <div class="form-group">
                                        <label class="form-label">R√©ceptions disponibles pour BCF-2024-0089</label>
                                        
                                        <label class="br-checkbox selected">
                                            <input type="checkbox" id="br-0156" checked onchange="toggleBR(this)">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; font-size: 13px;">BR-2024-0156 du 28/01/2024</div>
                                                <div style="font-size: 11px; color: #6B7280; margin-top: 4px;">
                                                    ‚Ä¢ 980 L de peinture re√ßus (98% de la commande)
                                                </div>
                                                <div style="font-size: 11px; margin-top: 4px;">
                                                    ‚Ä¢ Statut: <span class="badge badge-success">VALID√â</span>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                                                <i class="fa-solid fa-eye"></i> Voir d√©tail
                                            </button>
                                        </label>

                                        <label class="br-checkbox">
                                            <input type="checkbox" id="br-0162" onchange="toggleBR(this)">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; font-size: 13px;">BR-2024-0162 du 30/01/2024</div>
                                                <div style="font-size: 11px; color: #6B7280; margin-top: 4px;">
                                                    ‚Ä¢ 20 L de peinture re√ßus (2% de la commande)
                                                </div>
                                                <div style="font-size: 11px; margin-top: 4px;">
                                                    ‚Ä¢ Statut: <span class="badge badge-danger">LITIGE QUALIT√â</span>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                                                <i class="fa-solid fa-eye"></i> Voir d√©tail
                                            </button>
                                        </label>

                                        <div style="display: flex; gap: 8px; margin-top: 12px;">
                                            <button type="button" class="btn btn-secondary">
                                                <i class="fa-solid fa-check-double"></i> Tout s√©lectionner
                                            </button>
                                            <button type="button" class="btn btn-secondary">
                                                <i class="fa-solid fa-times"></i> Tout d√©s√©lectionner
                                            </button>
                                        </div>

                                        <div style="margin-top: 12px; padding: 12px; background: #FEF3C7; border: 1px solid #FCD34D; border-radius: 6px; font-size: 12px;">
                                            <strong>Total quantit√©s s√©lectionn√©es:</strong> 980 L / 1000 L command√©s (98%)
                                        </div>
                                    </div>
                                </div>

                                <!-- R√âCUP√âRATION DES LIGNES -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-download"></i> R√âCUP√âRATION DES LIGNES
                                    </h3>

                                    <div class="form-group">
                                        <label class="form-label">Options d'import</label>
                                        <div class="radio-group">
                                            <label class="radio-pill active" onclick="setImportOption('all')">
                                                <input type="radio" name="import-option" value="all" checked style="display: none;">
                                                Importer toutes les lignes non factur√©es
                                            </label>
                                            <label class="radio-pill" onclick="setImportOption('received')">
                                                <input type="radio" name="import-option" value="received" style="display: none;">
                                                Importer seulement les lignes r√©ceptionn√©es
                                            </label>
                                            <label class="radio-pill" onclick="setImportOption('manual')">
                                                <input type="radio" name="import-option" value="manual" style="display: none;">
                                                S√©lection manuelle des lignes
                                            </label>
                                        </div>
                                    </div>

                                    <button type="button" class="btn btn-primary" onclick="loadLinesFromBCFBR()">
                                        <i class="fa-solid fa-rotate"></i> Charger les lignes dans l'onglet suivant
                                    </button>

                                    <div class="alert-success" style="margin-top: 16px;">
                                        <i class="fa-solid fa-info-circle"></i>
                                        <div>
                                            <strong>‚ÑπÔ∏è Les lignes seront pr√©-remplies avec:</strong>
                                            <ul style="margin: 8px 0 0 20px; font-size: 12px;">
                                                <li>Quantit√©s des BR s√©lectionn√©s</li>
                                                <li>Prix du BCF (modifiables si n√©cessaire)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- NAVIGATION BUTTONS -->
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="cancelInvoice()">
                                        <i class="fa-solid fa-times"></i>
                                        Annuler
                                    </button>
                                    <div style="display: flex; gap: 12px;">
                                        <button type="button" class="btn btn-secondary" onclick="switchTab(0)">
                                            <i class="fa-solid fa-arrow-left"></i>
                                            Pr√©c√©dent
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                            <i class="fa-solid fa-save"></i> Enregistrer
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="switchTab(2)">
                                            Suivant
                                            <i class="fa-solid fa-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>

                            </div>

                            <!-- TAB 3: LIGNES DE FACTURE -->
                            <div class="tab-content" id="tab-2">
                                
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-list"></i> LIGNES DE FACTURE
                                    </h3>

                                    <div style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;">
                                        <button type="button" class="btn btn-secondary" onclick="addArticleLine()">
                                            <i class="fa-solid fa-plus"></i> Nouvelle ligne
                                        </button>
                                        <button type="button" class="btn btn-secondary">
                                            <i class="fa-solid fa-file-import"></i> Import Excel
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="calculateTotals()">
                                            <i class="fa-solid fa-rotate"></i> Recalculer
                                        </button>
                                        <button type="button" class="btn btn-secondary" style="margin-left: auto; background: #FEE2E2; color: #991B1B;">
                                            <i class="fa-solid fa-trash"></i> Supprimer s√©lection
                                        </button>
                                    </div>

                                    <div style="overflow-x: auto;">
                                        <table class="articles-table">
                                            <thead>
                                                <tr>
                                                    <th style="width: 40px;">#</th>
                                                    <th>Article</th>
                                                    <th>Description</th>
                                                    <th style="width: 80px;">Qt√© BCF</th>
                                                    <th style="width: 80px;">Qt√© BR</th>
                                                    <th style="width: 80px;">Qt√© Fact</th>
                                                    <th style="width: 100px;">PU BCF</th>
                                                    <th style="width: 100px;">PU Fact</th>
                                                    <th style="width: 60px;">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="articles-tbody">
                                                <!-- Articles loaded dynamically -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <button type="button" class="btn-add-line" onclick="addArticleLine()">
                                        <i class="fa-solid fa-plus"></i> Ajouter une ligne sans r√©f√©rence commande
                                    </button>
                                </div>

                                <!-- FRAIS ANNEXES -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-truck"></i> FRAIS ANNEXES (OPTIONNEL)
                                    </h3>

                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                            <input type="checkbox" id="enable-fees" onchange="toggleFees()">
                                            <span>Ajouter des frais annexes</span>
                                        </label>
                                    </div>

                                    <div id="fees-section" style="display: none;">
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label class="form-label">Transport</label>
                                                <div style="display: flex; gap: 8px;">
                                                    <input type="number" class="form-input" id="fee-transport" value="0" onchange="calculateTotals()">
                                                    <input type="text" class="form-input" id="fee-transport-desc" placeholder="Description" style="flex: 1;">
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">Assurance</label>
                                                <div style="display: flex; gap: 8px;">
                                                    <input type="number" class="form-input" id="fee-insurance" value="0" onchange="calculateTotals()">
                                                    <input type="text" class="form-input" id="fee-insurance-desc" placeholder="Description" style="flex: 1;">
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">Douane</label>
                                                <div style="display: flex; gap: 8px;">
                                                    <input type="number" class="form-input" id="fee-customs" value="0" onchange="calculateTotals()">
                                                    <input type="text" class="form-input" id="fee-customs-desc" placeholder="Description" style="flex: 1;">
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">Autres</label>
                                                <div style="display: flex; gap: 8px;">
                                                    <input type="number" class="form-input" id="fee-other" value="0" onchange="calculateTotals()">
                                                    <input type="text" class="form-input" id="fee-other-desc" placeholder="Description" style="flex: 1;">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- R√âSUM√â RAPPROCHEMENT -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-scale-balanced"></i> R√âSUM√â RAPPROCHEMENT
                                    </h3>

                                    <div style="padding: 16px; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 8px;">
                                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #1F2937;">
                                            ANALYSE 3-WAY (Commande / R√©ception / Facture)
                                        </h4>

                                        <div style="font-size: 13px; margin-bottom: 8px;">
                                            <strong>Total command√© (BCF):</strong> <span id="total-bcf">1,620,000 XAF</span>
                                        </div>
                                        <div style="font-size: 13px; margin-bottom: 8px;">
                                            <strong>Total re√ßu (BR):</strong> <span id="total-br">1,587,600 XAF</span> 
                                            <span style="color: #6B7280;">(98%)</span>
                                        </div>
                                        <div style="font-size: 13px; margin-bottom: 16px;">
                                            <strong>Total factur√©:</strong> <span id="total-invoiced" style="color: #263c89; font-weight: 700;">1,620,000 XAF</span>
                                        </div>

                                        <div id="ecart-status-ok" style="display: none; padding: 12px; background: #D1FAE5; border: 1px solid #6EE7B7; border-radius: 6px; margin-top: 12px;">
                                            <div style="font-weight: 600; color: #047857; margin-bottom: 4px;">
                                                ‚úÖ Statut: CONFORME
                                            </div>
                                            <div style="font-size: 12px; color: #065F46;">
                                                Aucun √©cart d√©tect√©
                                            </div>
                                        </div>

                                        <div id="ecart-status-warning" style="padding: 12px; background: #FEF3C7; border: 1px solid #FCD34D; border-radius: 6px; margin-top: 12px;">
                                            <div style="font-weight: 600; color: #92400E; margin-bottom: 4px;">
                                                ‚ö†Ô∏è Statut: √âCART D√âTECT√â
                                            </div>
                                            <ul style="margin: 8px 0 0 20px; font-size: 12px; color: #78350F;">
                                                <li>Ligne 1: Quantit√© factur√©e > re√ßue (+20 L)</li>
                                                <li>Impact financier: 29,000 XAF</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- NAVIGATION BUTTONS -->
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="cancelInvoice()">
                                        <i class="fa-solid fa-times"></i>
                                        Annuler
                                    </button>
                                    <div style="display: flex; gap: 12px;">
                                        <button type="button" class="btn btn-secondary" onclick="switchTab(1)">
                                            <i class="fa-solid fa-arrow-left"></i>
                                            Pr√©c√©dent
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                            <i class="fa-solid fa-save"></i> Enregistrer
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="switchTab(3)">
                                            Suivant
                                            <i class="fa-solid fa-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>

                            </div>

                            <!-- TAB 4: TVA ET TOTAUX -->
                            <div class="tab-content" id="tab-3">
                                
                                <!-- CALCUL TVA SELON R√âGIME FISCAL -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-percent"></i> CALCUL TVA SELON R√âGIME FISCAL
                                    </h3>

                                    <div style="padding: 12px; background: #F9FAFB; border-radius: 6px; font-size: 12px; margin-bottom: 16px;">
                                        <div style="margin-bottom: 6px;"><strong>R√©gime fiscal du fournisseur:</strong> R√âEL</div>
                                        <div><strong>Taux TVA applicable:</strong> 19.25%</div>
                                    </div>

                                    <h4 style="font-size: 14px; font-weight: 600; margin: 16px 0 12px;">VENTILATION TVA PAR TAUX</h4>

                                    <div style="overflow-x: auto;">
                                        <table class="articles-table">
                                            <thead>
                                                <tr>
                                                    <th>Taux TVA</th>
                                                    <th>Base HT</th>
                                                    <th>Montant TVA</th>
                                                    <th>D√©ductible</th>
                                                    <th>Total TTC</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td style="font-weight: 600;">19.25%</td>
                                                    <td><input type="text" class="form-input" id="base-ht-1925" value="1,620,000 XAF" readonly></td>
                                                    <td><input type="text" class="form-input" id="tva-1925" value="311,850 XAF" readonly></td>
                                                    <td style="text-align: center;">
                                                        <input type="checkbox" id="tva-deductible-1925" checked>
                                                    </td>
                                                    <td><input type="text" class="form-input" id="ttc-1925" value="1,931,850 XAF" readonly></td>
                                                </tr>
                                                <tr>
                                                    <td style="font-weight: 600;">0%</td>
                                                    <td><input type="text" class="form-input" value="0 XAF" readonly></td>
                                                    <td><input type="text" class="form-input" value="0 XAF" readonly></td>
                                                    <td style="text-align: center;">
                                                        <input type="checkbox" disabled>
                                                    </td>
                                                    <td><input type="text" class="form-input" value="0 XAF" readonly></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <button type="button" class="btn btn-secondary" style="margin-top: 12px;">
                                        <i class="fa-solid fa-plus"></i> Ajouter un taux diff√©rent
                                    </button>

                                    <div class="alert-warning" style="margin-top: 16px;">
                                        <i class="fa-solid fa-info-circle"></i>
                                        <div>
                                            <strong>‚ÑπÔ∏è TVA non d√©ductible pour:</strong>
                                            <ul style="margin: 8px 0 0 20px; font-size: 12px;">
                                                <li>V√©hicules de tourisme</li>
                                                <li>Frais de logement</li>
                                                <li>Certains frais de repr√©sentation</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- R√âCAPITULATIF DES TOTAUX -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-calculator"></i> R√âCAPITULATIF DES TOTAUX
                                    </h3>

                                    <div class="totals-box">
                                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">CALCUL D√âTAILL√â</h4>

                                        <div class="totals-row">
                                            <div class="totals-label">Total articles HT:</div>
                                            <div class="totals-value" id="total-articles-ht">1,620,000 XAF</div>
                                        </div>
                                        <div class="totals-row">
                                            <div class="totals-label">Total frais annexes HT:</div>
                                            <div class="totals-value" id="total-fees-ht">0 XAF</div>
                                        </div>
                                        <div class="totals-row" style="border-top: 2px solid #263c89; padding-top: 12px;">
                                            <div class="totals-label">TOTAL HT:</div>
                                            <div class="totals-value" id="total-ht">1,620,000 XAF</div>
                                        </div>

                                        <div class="totals-row" style="margin-top: 12px;">
                                            <div class="totals-label">TVA d√©ductible (19.25%):</div>
                                            <div class="totals-value" id="tva-deductible-amount">311,850 XAF</div>
                                        </div>
                                        <div class="totals-row">
                                            <div class="totals-label">TVA non d√©ductible:</div>
                                            <div class="totals-value" id="tva-non-deductible">0 XAF</div>
                                        </div>
                                        <div class="totals-row" style="border-top: 2px solid #263c89; padding-top: 12px;">
                                            <div class="totals-label">TOTAL TVA:</div>
                                            <div class="totals-value" id="total-tva">311,850 XAF</div>
                                        </div>

                                        <div class="totals-row" style="margin-top: 12px; border-top: 3px solid #263c89; padding-top: 12px; font-size: 18px;">
                                            <div class="totals-label">TOTAL TTC √Ä PAYER:</div>
                                            <div class="totals-value" id="total-ttc">1,931,850 XAF</div>
                                        </div>

                                        <div class="totals-row" style="margin-top: 12px; border-top: 1px dashed #E5E7EB; padding-top: 12px; font-size: 13px;">
                                            <div class="totals-label">Escompte possible (2%):</div>
                                            <div class="totals-value" id="escompte-amount" style="color: #10B981;">-38,637 XAF</div>
                                        </div>
                                        <div class="totals-row">
                                            <div class="totals-label">Net √† payer si escompte:</div>
                                            <div class="totals-value" id="net-with-escompte">1,893,213 XAF</div>
                                        </div>

                                        <div class="totals-row" style="margin-top: 12px; border-top: 1px dashed #E5E7EB; padding-top: 12px; font-size: 13px; color: #6B7280;">
                                            <div>Date √©ch√©ance normale:</div>
                                            <div id="due-date-display">02/03/2024</div>
                                        </div>
                                        <div class="totals-row" style="font-size: 13px; color: #6B7280;">
                                            <div>Date limite escompte:</div>
                                            <div id="escompte-date-display">10/02/2024</div>
                                        </div>
                                    </div>

                                    <!-- MONTANT EN LETTRES -->
                                    <div style="margin-top: 16px; padding: 12px; background: #EFF6FF; border: 1px solid #BFDBFE; border-radius: 6px;">
                                        <strong style="font-size: 12px; color: #1F2937;">MONTANT EN LETTRES:</strong>
                                        <div id="amount-in-words" style="font-size: 13px; margin-top: 8px; color: #263c89; font-weight: 600;">
                                            Un million neuf cent trente et un mille huit cent cinquante francs CFA
                                        </div>
                                    </div>
                                </div>

                                <!-- IMPUTATION BUDG√âTAIRE -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-wallet"></i> IMPUTATION BUDG√âTAIRE
                                    </h3>

                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Ligne budg√©taire</label>
                                            <select class="form-select" id="budget-line">
                                                <option value="">S√©lectionner</option>
                                                <option value="MP-PROD" selected>Mati√®res premi√®res - Production</option>
                                                <option value="CONS-BUR">Consommables Bureau</option>
                                                <option value="MAIN-MAT">Maintenance Mat√©riel</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Centre de co√ªt</label>
                                            <select class="form-select" id="cost-center">
                                                <option value="">S√©lectionner</option>
                                                <option value="USINE-DLA" selected>Usine Douala</option>
                                                <option value="LOG-YDE">Logistique Yaound√©</option>
                                                <option value="ADMIN">Administration</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Projet/Affaire (optionnel)</label>
                                            <select class="form-select" id="project">
                                                <option value="">Aucun</option>
                                                <option value="SONARA-2024" selected>Commande SONARA 2024</option>
                                                <option value="GOVT-2024">Contrat gouvernement 2024</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div style="margin-top: 16px; padding: 16px; background: #D1FAE5; border: 1px solid #6EE7B7; border-radius: 6px;">
                                        <div style="font-size: 13px; margin-bottom: 8px;">
                                            <strong>Budget disponible:</strong> <span style="color: #047857; font-weight: 700;">8,500,000 XAF</span>
                                        </div>
                                        <div style="font-size: 13px; margin-bottom: 8px;">
                                            <strong>Cette facture:</strong> <span style="color: #263c89; font-weight: 700;">1,620,000 XAF</span>
                                        </div>
                                        <div style="font-size: 13px;">
                                            <strong>Solde apr√®s:</strong> <span style="color: #047857; font-weight: 700;">6,880,000 XAF ‚úÖ</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- NAVIGATION BUTTONS -->
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="cancelInvoice()">
                                        <i class="fa-solid fa-times"></i>
                                        Annuler
                                    </button>
                                    <div style="display: flex; gap: 12px;">
                                        <button type="button" class="btn btn-secondary" onclick="switchTab(2)">
                                            <i class="fa-solid fa-arrow-left"></i>
                                            Pr√©c√©dent
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                            <i class="fa-solid fa-save"></i> Enregistrer
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="switchTab(4)">
                                            Suivant
                                            <i class="fa-solid fa-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>

                            </div>

                            <!-- TAB 5: PI√àCES JOINTES -->
                            <div class="tab-content" id="tab-4">
                                
                                <!-- FACTURE SCANN√âE -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-file-pdf"></i> FACTURE SCANN√âE (OBLIGATOIRE)
                                    </h3>

                                    <div class="file-upload-zone" onclick="document.getElementById('invoice-file').click()">
                                        <i class="fa-solid fa-file-pdf" style="font-size: 32px; color: #9CA3AF; margin-bottom: 8px;"></i>
                                        <div style="font-weight: 500; color: #374151; margin-bottom: 4px;">
                                            üìÑ Glisser la facture scann√©e ici
                                        </div>
                                        <div style="font-weight: 500; color: #374151; margin-bottom: 8px;">
                                            ou [Parcourir] pour s√©lectionner
                                        </div>
                                        <div style="font-size: 12px; color: #9CA3AF;">
                                            Formats: PDF, JPG, PNG (Max 10MB)
                                        </div>
                                        <input type="file" id="invoice-file" style="display: none;" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(event)" required>
                                    </div>

                                    <div id="invoice-file-display" style="margin-top: 12px; display: none;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #D1FAE5; border: 1px solid #6EE7B7; border-radius: 6px;">
                                            <div>
                                                <div style="font-weight: 600; font-size: 13px;">‚úÖ Facture_ChemTech_2024-0156.pdf</div>
                                                <div style="font-size: 11px; color: #047857;">2.3 MB | Upload√© le 31/01/2024 10:30</div>
                                            </div>
                                            <div style="display: flex; gap: 8px;">
                                                <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 11px;">
                                                    <i class="fa-solid fa-eye"></i> Voir
                                                </button>
                                                <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 11px;">
                                                    <i class="fa-solid fa-trash"></i> Supprimer
                                                </button>
                                                <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 11px;">
                                                    <i class="fa-solid fa-rotate"></i> Remplacer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- DOCUMENTS COMPL√âMENTAIRES -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-folder-open"></i> DOCUMENTS COMPL√âMENTAIRES
                                    </h3>

                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; margin-bottom: 8px;">
                                            <input type="checkbox" id="has-bl">
                                            <span>Bon de livraison fournisseur</span>
                                        </label>
                                        <div id="bl-upload" style="display: none; margin-left: 28px;">
                                            <button type="button" class="btn btn-secondary" style="font-size: 12px;">
                                                <i class="fa-solid fa-plus"></i> Ajouter document
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; margin-bottom: 8px;">
                                            <input type="checkbox" id="has-certificate">
                                            <span>Certificat de conformit√©</span>
                                        </label>
                                        <div id="certificate-upload" style="display: none; margin-left: 28px;">
                                            <button type="button" class="btn btn-secondary" style="font-size: 12px;">
                                                <i class="fa-solid fa-plus"></i> Ajouter document
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; margin-bottom: 8px;">
                                            <input type="checkbox" id="has-quality-report">
                                            <span>Rapport de contr√¥le qualit√©</span>
                                        </label>
                                        <div id="quality-upload" style="display: none; margin-left: 28px;">
                                            <button type="button" class="btn btn-secondary" style="font-size: 12px;">
                                                <i class="fa-solid fa-plus"></i> Ajouter document
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; margin-bottom: 8px;">
                                            <input type="checkbox" id="has-correspondence" checked>
                                            <span>Correspondances</span>
                                        </label>
                                        <div id="correspondence-display" style="margin-left: 28px; padding: 12px; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 6px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <div>
                                                    <div style="font-weight: 600; font-size: 13px;">üìé Email_accord_prix_ChemTech.pdf</div>
                                                    <div style="font-size: 11px; color: #6B7280;">125 KB</div>
                                                </div>
                                                <div style="display: flex; gap: 8px;">
                                                    <button type="button" class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px;">
                                                        <i class="fa-solid fa-eye"></i> Voir
                                                    </button>
                                                    <button type="button" class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px; background: #FEE2E2; color: #991B1B;">
                                                        <i class="fa-solid fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- AUTRES PI√àCES JOINTES -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-paperclip"></i> AUTRES PI√àCES JOINTES
                                    </h3>

                                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('other-files').click()">
                                        <i class="fa-solid fa-plus"></i> Ajouter un document
                                    </button>
                                    <input type="file" id="other-files" style="display: none;" multiple onchange="handleOtherFiles(event)">

                                    <div id="other-files-list" style="margin-top: 12px;">
                                        <div style="padding: 12px; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 6px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <div>
                                                    <div style="font-weight: 600; font-size: 13px;">‚Ä¢ Note_reception_BR-0156.pdf</div>
                                                    <div style="font-size: 11px; color: #6B7280;">458 KB</div>
                                                </div>
                                                <div style="display: flex; gap: 8px;">
                                                    <button type="button" class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px;">
                                                        <i class="fa-solid fa-eye"></i> Voir
                                                    </button>
                                                    <button type="button" class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px; background: #FEE2E2; color: #991B1B;">
                                                        <i class="fa-solid fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- NOTES ET COMMENTAIRES -->
                                <div class="section-card">
                                    <h3 class="section-title">
                                        <i class="fa-solid fa-comment"></i> NOTES ET COMMENTAIRES
                                    </h3>

                                    <div class="form-group">
                                        <label class="form-label">Notes internes (visibles uniquement en interne)</label>
                                        <textarea class="form-textarea" id="internal-notes" placeholder="√âcart de 20L √† r√©gulariser avec le fournisseur.
Litige cr√©√© pour suivi. Contact commercial en cours."></textarea>
                                    </div>
                                </div>

                                <!-- R√âSUM√â ET VALIDATION -->
                                <div class="section-card" style="background: #EFF6FF; border: 2px solid #BFDBFE;">
                                    <h3 class="section-title" style="color: #263c89;">
                                        <i class="fa-solid fa-clipboard-check"></i> R√âSUM√â ET VALIDATION
                                    </h3>

                                    <div style="padding: 16px; background: white; border-radius: 6px; margin-bottom: 16px;">
                                        <div style="font-size: 12px; color: #6B7280; margin-bottom: 12px;">
                                            Progression: <strong style="color: #263c89;">80%</strong> - Il reste √† valider la facture
                                        </div>
                                        <div style="width: 100%; height: 8px; background: #E5E7EB; border-radius: 999px; overflow: hidden;">
                                            <div style="width: 80%; height: 100%; background: #263c89;"></div>
                                        </div>
                                    </div>

                                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">CONTR√îLES AUTOMATIQUES</h4>

                                    <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                                        <div style="font-size: 13px;">
                                            <span style="color: #10B981;">‚úÖ</span> Certificat non-redevance valide
                                        </div>
                                        <div style="font-size: 13px;">
                                            <span style="color: #F59E0B;">‚ö†Ô∏è</span> √âcart quantit√© d√©tect√© (Ligne 1: +20L)
                                        </div>
                                        <div style="font-size: 13px;">
                                            <span style="color: #10B981;">‚úÖ</span> Budget disponible suffisant
                                        </div>
                                        <div style="font-size: 13px;">
                                            <span style="color: #10B981;">‚úÖ</span> Facture scann√©e upload√©e
                                        </div>
                                        <div style="font-size: 13px;">
                                            <span style="color: #10B981;">‚úÖ</span> Rapprochement BCF/BR effectu√©
                                        </div>
                                    </div>

                                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">WORKFLOW DE VALIDATION</h4>

                                    <div style="padding: 12px; background: white; border-radius: 6px; font-size: 12px; margin-bottom: 16px;">
                                        <div style="margin-bottom: 8px;">
                                            <strong>Montant:</strong> 1,931,850 XAF ‚Üí Validation requise:
                                        </div>
                                        <ul style="margin: 8px 0 0 20px;">
                                            <li>‚Ä¢ Niveau 1: Comptable (vous) - <span class="badge badge-warning">EN COURS</span></li>
                                            <li>‚Ä¢ Niveau 2: Chef comptable - <span class="badge" style="background: #E5E7EB; color: #6B7280;">EN ATTENTE</span> (seuil > 1M XAF)</li>
                                        </ul>
                                    </div>

                                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">ACTIONS DISPONIBLES</h4>

                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 12px;">
                                        <button type="button" class="btn btn-secondary">
                                            <i class="fa-solid fa-copy"></i> Dupliquer
                                        </button>
                                        <button type="button" class="btn btn-secondary">
                                            <i class="fa-solid fa-print"></i> Aper√ßu
                                        </button>
                                        <button type="button" class="btn btn-secondary">
                                            <i class="fa-solid fa-envelope"></i> Envoyer validation
                                        </button>
                                    </div>

                                    <div style="font-size: 11px; color: #6B7280; margin-top: 12px; padding-top: 12px; border-top: 1px solid #E5E7EB;">
                                        <strong>Historique:</strong> Cr√©√© le 31/01/2024 10:30 par J.EKANI | Modifi√©: 31/01 11:15
                                    </div>
                                </div>

                                <!-- Si √©carts -->
                                <div id="ecart-actions" class="section-card" style="background: #FEF3C7; border: 2px solid #FCD34D;">
                                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #92400E;">
                                        <i class="fa-solid fa-exclamation-triangle"></i> ACTIONS SUITE AUX √âCARTS D√âTECT√âS
                                    </h4>

                                    <div style="display: flex; gap: 12px;">
                                        <button type="button" class="btn btn-secondary">
                                            <i class="fa-solid fa-rotate"></i> Demander avoir
                                        </button>
                                        <button type="button" class="btn btn-secondary">
                                            <i class="fa-solid fa-clipboard-list"></i> Cr√©er litige
                                        </button>
                                    </div>
                                </div>

                                <!-- NAVIGATION BUTTONS -->
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="cancelInvoice()">
                                        <i class="fa-solid fa-times"></i>
                                        Annuler
                                    </button>
                                    <div style="display: flex; gap: 12px;">
                                        <button type="button" class="btn btn-secondary" onclick="switchTab(3)">
                                            <i class="fa-solid fa-arrow-left"></i>
                                            Pr√©c√©dent
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                            <i class="fa-solid fa-save"></i> Enregistrer brouillon
                                        </button>
                                        <button type="button" class="btn btn-success" onclick="validateInvoice()">
                                            <i class="fa-solid fa-check"></i> Valider et soumettre
                                        </button>
                                    </div>
                                </div>

                            </div>

                        </form>

                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./js/facture-create.js"></script>
</body>
</html>
