<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCF Direct - Création immédiate</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">

    <!-- Styles -->
    <link rel="stylesheet" href="./styles/achats-common.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        * {
            font-family: "Poppins", sans-serif;
        }
        html, body {
            height: 100%;
            margin: 0;
            background: #F5F6FA;
        }
        .direct-screen {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #6B7280;
            margin-bottom: 20px;
        }
        .breadcrumb a {
            color: #263c89;
            text-decoration: none;
            font-weight: 600;
        }
        .page-hero {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            gap: 24px;
        }
        .hero-left h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 8px;
        }
        .hero-left p {
            color: #6B7280;
            font-size: 14px;
        }
        .hero-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }
        .hero-tag {
            background: #EEF2FF;
            color: #3730A3;
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 12px;
            font-weight: 600;
        }
        .hero-right {
            min-width: 240px;
            border-left: 1px solid #E5E7EB;
            padding-left: 24px;
        }
        .hero-right .user {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .hero-right img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }
        .hero-right .user-info {
            display: flex;
            flex-direction: column;
        }
        .hero-right .user-info span:first-child {
            font-weight: 600;
            color: #111827;
        }
        .hero-right .user-info span:last-child {
            color: #6B7280;
            font-size: 13px;
        }
        .alert-direct {
            background: #FEF3C7;
            border: 1px solid #FCD34D;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }
        .alert-direct i {
            color: #D97706;
            font-size: 24px;
        }
        .alert-direct strong {
            color: #92400E;
            font-size: 15px;
        }
        .section-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 24px;
        }
        .section-grid.two-cols {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }
        .section-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
        }
        .section-title {
            font-size: 15px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-title span {
            font-size: 12px;
            font-weight: 600;
            color: #6B7280;
        }
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }
        .data-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .data-field label {
            font-size: 12px;
            font-weight: 600;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .data-field input,
        .data-field select,
        .data-field textarea {
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .data-field textarea {
            min-height: 90px;
            resize: vertical;
        }
        .data-field input:focus,
        .data-field select:focus,
        .data-field textarea:focus {
            outline: none;
            border-color: #263c89;
            box-shadow: 0 0 0 3px rgba(38, 60, 137, 0.12);
        }
        .radio-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .radio-pill {
            border: 1px solid #E5E7EB;
            border-radius: 999px;
            padding: 6px 14px;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
        }
        .radio-pill.active {
            background: #263c89;
            color: white;
            border-color: #263c89;
        }
        .supplier-card {
            border: 1px solid #E5E7EB;
            border-radius: 14px;
            padding: 20px;
            background: #F9FAFB;
        }
        .supplier-header {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 12px;
        }
        .supplier-header h4 {
            margin: 0;
            font-size: 16px;
            color: #111827;
        }
        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
        }
        .pill-success {
            background: #D1FAE5;
            color: #047857;
        }
        .pill-warning {
            background: #FEF3C7;
            color: #B45309;
        }
        .pill-danger {
            background: #FEE2E2;
            color: #B91C1C;
        }
        .articles-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        .btn-ghost {
            border: 1px dashed #CBD5F5;
            background: #EEF2FF;
            color: #1E3A8A;
            font-weight: 600;
            border-radius: 12px;
            padding: 10px 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn-ghost:hover {
            background: #E0E7FF;
        }
        .articles-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            overflow: hidden;
        }
        .articles-table th {
            background: #F3F4F6;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            color: #4B5563;
            padding: 12px;
            text-align: left;
        }
        .articles-table td {
            border-top: 1px solid #E5E7EB;
            padding: 12px;
            vertical-align: top;
            background: white;
        }
        .article-name-select,
        .article-input {
            width: 100%;
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            padding: 8px 10px;
            font-size: 13px;
        }
        .article-meta {
            margin-top: 8px;
            font-size: 12px;
            color: #6B7280;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 8px;
        }
        .stock-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }
        .stock-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        .stock-dot.critical { background: #DC2626; }
        .stock-dot.warning { background: #F59E0B; }
        .stock-dot.ok { background: #10B981; }
        .totals-strip {
            margin-top: 16px;
            border-radius: 14px;
            border: 1px solid #E5E7EB;
            padding: 16px;
            background: #F9FAFB;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }
        .totals-strip .label {
            font-size: 12px;
            text-transform: uppercase;
            color: #6B7280;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .totals-strip .value {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
        }
        .fees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }
        .fees-grid input {
            width: 100%;
        }
        .budget-box {
            border: 1px solid #E5E7EB;
            border-radius: 14px;
            padding: 16px;
            background: #F8FAFC;
        }
        .budget-box .row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .budget-box .row strong {
            font-weight: 700;
        }
        .budget-progress {
            height: 12px;
            border-radius: 999px;
            background: #E5E7EB;
            margin: 12px 0;
            overflow: hidden;
        }
        .budget-progress .bar {
            height: 100%;
            background: linear-gradient(90deg, #F97316 0%, #EF4444 100%);
        }
        .workflow-table {
            width: 100%;
            border-collapse: collapse;
        }
        .workflow-table th,
        .workflow-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #E5E7EB;
            font-size: 13px;
            text-align: left;
        }
        .workflow-table th {
            text-transform: uppercase;
            font-size: 11px;
            color: #6B7280;
        }
        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-chip.pending {
            background: #DBEAFE;
            color: #1D4ED8;
        }
        .documents-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .document-item {
            border: 1px dashed #CBD5F5;
            border-radius: 12px;
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }
        .document-actions {
            display: flex;
            gap: 8px;
        }
        .document-actions button {
            border: none;
            background: none;
            cursor: pointer;
            color: #374151;
        }
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        .notes-grid textarea {
            width: 100%;
        }
        .recap-card {
            border: 1px solid #E5E7EB;
            border-radius: 16px;
            padding: 20px;
            background: white;
        }
        .recap-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
        }
        .recap-item {
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 12px;
            background: #F9FAFB;
        }
        .actions-bar {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .actions-bar button {
            border-radius: 12px;
            padding: 12px 18px;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }
        .btn-primary {
            background: #263c89;
            color: white;
        }
        .btn-outline {
            border: 1px solid #CBD5F5;
            background: white;
            color: #1E3A8A;
        }
        .actions-after ul {
            margin: 12px 0 0;
            padding-left: 18px;
            color: #374151;
        }
        .mapping-block pre {
            background: #111827;
            color: #F3F4F6;
            padding: 16px;
            border-radius: 12px;
            font-size: 12px;
            overflow: auto;
            max-height: 360px;
        }
        @media (max-width: 1024px) {
            .page-hero {
                flex-direction: column;
            }
            .hero-right {
                border-left: none;
                border-top: 1px solid #E5E7EB;
                padding-left: 0;
                padding-top: 16px;
            }
        }
    </style>
</head>
<body class="h-full text-gray-800">
    <div class="h-screen flex flex-col">
        <!-- Header -->
        <header class="flex h-16 bg-white shadow-sm z-50">
            <div class="w-60 bg-[#263c89] flex items-center justify-center">
                <img src="https://microfinance-ccm.com/iola/logo-blanc.png" alt="Multiflex" class="h-10">
            </div>

            <div class="flex-1 flex items-center justify-between px-6">
                <h1 class="text-xl font-bold text-[#1A1A1A]">Création Directe BCF</h1>

                <div class="flex items-center gap-4">
                    <i class="fa-solid fa-bell text-[#666666] text-lg cursor-pointer"></i>
                    <div class="flex items-center cursor-pointer">
                        <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg" class="w-8 h-8 rounded-full mr-3" alt="Marie DJOMO">
                        <span class="text-[14px] text-[#1A1A1A] mr-2">Marie DJOMO</span>
                        <i class="fa-solid fa-chevron-down text-[#666666] text-sm"></i>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-60 bg-[#263c89] text-white overflow-y-auto">
                <nav class="py-4">
                    <div class="px-4 py-2 text-[12px] font-semibold text-white/60 uppercase tracking-wider mb-2">
                        Module Achats
                    </div>

                    <a href="./dashboard.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-chart-line mr-3"></i>
                        Dashboard
                    </a>

                    <a href="./fournisseurs-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-truck mr-3"></i>
                        Fournisseurs
                    </a>

                    <a href="./demandes-achat-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-file-lines mr-3"></i>
                        Demandes d'Achat
                    </a>

                    <a href="./commandes-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-shopping-cart mr-3"></i>
                        Bons de Commande
                    </a>

                    <a href="./commande-create.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-plus mr-3"></i>
                        Créer BCF (DA)
                    </a>

                    <a href="./commande-directe-create.html" class="block px-4 py-2 text-[14px] bg-[#152045] transition-colors">
                        <i class="fa-solid fa-bolt mr-3"></i>
                        BCF Direct
                    </a>

                    <a href="./receptions-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-box-open mr-3"></i>
                        Réceptions
                    </a>

                    <a href="./factures-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-file-invoice mr-3"></i>
                        Factures
                    </a>

                    <a href="./litiges-list.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-exclamation-triangle mr-3"></i>
                        Litiges Fournisseurs
                    </a>

                    <div class="px-4 py-2 text-[12px] font-semibold text-white/60 uppercase tracking-wider mt-6 mb-2">
                        Système
                    </div>

                    <a href="../index.html" class="block px-4 py-2 text-[14px] hover:bg-[#152045] transition-colors">
                        <i class="fa-solid fa-home mr-3"></i>
                        Accueil
                    </a>
                </nav>
            </aside>

            <!-- Main content -->
            <main class="flex-1 overflow-auto bg-[#F8F9FA]">
                <div class="direct-screen">
                    <div class="breadcrumb">
                        <a href="./commandes-list.html"><i class="fa-solid fa-shopping-cart mr-2"></i>Bons de Commande</a>
                        <i class="fa-solid fa-chevron-right text-[11px]"></i>
                        <span>Création directe</span>
                    </div>

                    <div class="page-hero">
                        <div class="hero-left">
                            <h1>Nouveau Bon de Commande Fournisseur (Direct)</h1>
                            <p>US-PROC-007 • Création d'un BCF sans Demande d'Achat avec contrôle renforcé</p>
                            <div class="hero-tags">
                                <span class="hero-tag"><i class="fa-solid fa-bolt"></i> Mode Direct</span>
                                <span class="hero-tag"><i class="fa-solid fa-user-shield"></i> Traçabilité renforcée</span>
                                <span class="hero-tag"><i class="fa-solid fa-calculator"></i> Budget auto</span>
                                <span class="hero-tag"><i class="fa-solid fa-receipt"></i> TVA 19.25%</span>
                            </div>
                        </div>
                        <div class="hero-right">
                            <div class="user">
                                <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg" alt="Marie DJOMO">
                                <div class="user-info">
                                    <span>Marie DJOMO</span>
                                    <span>Acheteuse Senior • Achats Directs</span>
                                </div>
                            </div>
                            <div style="margin-top: 16px; font-size: 13px; color: #6B7280;">
                                <div>Dernière mise à jour: <strong id="hero-updated-at">31/01/2024 10:12</strong></div>
                                <div>Statut: <span class="status-chip pending" id="hero-status">Brouillon</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="alert-direct">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <div>
                            <strong>Mode Création Directe (sans DA)</strong>
                            <p style="margin: 6px 0 0; color: #92400E; font-size: 14px;">
                                Justification obligatoire, validation demandeur initial + manager Achats, certif. non-redevance impératif.
                            </p>
                        </div>
                    </div>

                    <div class="section-card" id="section-justification">
                        <div class="section-title">
                            <i class="fa-solid fa-comment-dots text-[#263c89]"></i>
                            Justification de l'achat direct *
                        </div>
                        <div class="data-grid">
                            <div class="data-field" style="grid-column: span 2;">
                                <label>Motif détaillé</label>
                                <textarea id="direct-justification" placeholder="Décrire la raison de la création sans DA"></textarea>
                                <span class="form-help" id="justification-helper">Requis avant soumission. Contexte rupture stock, urgence client, etc.</span>
                            </div>
                            <div class="data-field">
                                <label>Niveau d'urgence</label>
                                <select id="direct-mode-urgency">
                                    <option value="NORMAL">Normal</option>
                                    <option value="URGENT">Urgent</option>
                                    <option value="CRITIQUE">Critique</option>
                                </select>
                            </div>
                            <div class="data-field">
                                <label>Impact métier</label>
                                <input type="text" id="direct-impact" placeholder="Production arrêtée, SLA client, etc.">
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-title">
                            <i class="fa-solid fa-circle-info text-[#263c89]"></i>
                            Informations générales
                        </div>
                        <div class="data-grid">
                            <div class="data-field">
                                <label>N° Commande</label>
                                <input type="text" id="order-number" readonly style="background:#F3F4F6;">
                            </div>
                            <div class="data-field">
                                <label>Date commande *</label>
                                <input type="date" id="order-date">
                            </div>
                            <div class="data-field">
                                <label>Exercice fiscal</label>
                                <input type="number" id="fiscal-year">
                            </div>
                            <div class="data-field" style="grid-column: span 2;">
                                <label>Type commande *</label>
                                <div class="radio-group" id="order-type-group">
                                    <span class="radio-pill" data-value="STANDARD">Standard</span>
                                    <span class="radio-pill" data-value="FRAME">Contrat-cadre</span>
                                    <span class="radio-pill" data-value="URGENT">Urgence</span>
                                    <span class="radio-pill" data-value="IMPORT">Import</span>
                                </div>
                            </div>
                            <div class="data-field">
                                <label>Priorité *</label>
                                <select id="order-priority">
                                    <option value="NORMAL">Normal</option>
                                    <option value="URGENT">Urgent</option>
                                    <option value="CRITIQUE">Critique</option>
                                </select>
                            </div>
                            <div class="data-field">
                                <label>Catégorie achat *</label>
                                <select id="purchase-category">
                                    <option value="DIRECT_MATERIAL">DIRECT_MATERIAL - Production</option>
                                    <option value="INDIRECT_MATERIAL">INDIRECT_MATERIAL - Fonctionnement</option>
                                    <option value="SERVICES">SERVICES - Prestations</option>
                                    <option value="CAPEX">CAPEX - Investissements</option>
                                </select>
                            </div>
                            <div class="data-field" style="grid-column: span 2;">
                                <label>Libellé catégorie</label>
                                <input type="text" id="category-label">
                            </div>
                        </div>
                    </div>

                    <div class="section-grid two-cols">
                        <div class="section-card">
                            <div class="section-title">
                                <i class="fa-solid fa-truck-ramp-box text-[#263c89]"></i>
                                Fournisseur sélectionné
                            </div>
                            <div class="supplier-card" id="supplier-card">
                                <div class="supplier-header">
                                    <h4 id="supplier-name">-</h4>
                                    <span class="status-pill pill-success" id="supplier-type-pill">Externe</span>
                                </div>
                                <div class="data-grid" style="margin-bottom: 12px;">
                                    <div class="data-field">
                                        <label>Code fournisseur</label>
                                        <input type="text" id="supplier-code" readonly>
                                    </div>
                                    <div class="data-field">
                                        <label>Type</label>
                                        <input type="text" id="supplier-type" readonly>
                                    </div>
                                </div>
                                <div style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:12px;">
                                    <span class="status-pill pill-success" id="supplier-niu"></span>
                                    <span class="status-pill pill-success" id="supplier-certificate"></span>
                                </div>
                                <div style="font-size:13px; color:#374151; margin-bottom:12px;">
                                    <i class="fa-solid fa-location-dot text-[#EF4444] mr-2"></i>
                                    <span id="supplier-address"></span>
                                </div>
                                <div style="font-size:13px; color:#374151; margin-bottom:8px;">
                                    <i class="fa-solid fa-phone text-[#10B981] mr-2"></i>
                                    <span id="supplier-contact"></span>
                                </div>
                                <div style="font-size:13px; color:#374151;">
                                    <i class="fa-solid fa-envelope text-[#6366F1] mr-2"></i>
                                    <span id="supplier-email"></span>
                                </div>
                                <div style="margin-top:16px;">
                                    <div style="font-size:12px; text-transform:uppercase; color:#6B7280; font-weight:600; margin-bottom:6px;">
                                        Conditions négociées
                                    </div>
                                    <ul id="supplier-conditions" style="list-style:disc; padding-left:18px; color:#374151; font-size:13px;"></ul>
                                </div>
                            </div>
                        </div>

                        <div class="section-card">
                            <div class="section-title">
                                <i class="fa-solid fa-user-tie text-[#263c89]"></i>
                                Demandeur & origine besoin
                            </div>
                            <div class="data-grid">
                                <div class="data-field">
                                    <label>Demandeur initial *</label>
                                    <select id="originator-select"></select>
                                </div>
                                <div class="data-field">
                                    <label>Département</label>
                                    <input type="text" id="originator-department" readonly>
                                </div>
                                <div class="data-field">
                                    <label>Acheteur responsable *</label>
                                    <input type="text" id="buyer-name" readonly>
                                </div>
                                <div class="data-field">
                                    <label>Société acheteuse *</label>
                                    <select id="buying-company"></select>
                                </div>
                                <div class="data-field" style="grid-column: span 2;">
                                    <label>Centre de coût</label>
                                    <select id="cost-center"></select>
                                </div>
                                <div class="data-field" style="grid-column: span 2;">
                                    <label>Projet / Affaire</label>
                                    <input type="text" id="project-code" placeholder="Optionnel">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-title">
                            <i class="fa-solid fa-boxes-stacked text-[#263c89]"></i>
                            Articles à commander
                            <span id="articles-count">0 ligne</span>
                        </div>

                        <div class="articles-actions">
                            <button class="btn-ghost" onclick="handleAddArticleLine()"><i class="fa-solid fa-plus"></i> Ajouter article</button>
                            <button class="btn-ghost" onclick="handleImportCatalog()"><i class="fa-solid fa-file-import"></i> Importer depuis catalogue</button>
                            <button class="btn-ghost" onclick="handleCopyRequisition()"><i class="fa-solid fa-copy"></i> Copier une DA</button>
                        </div>

                        <div style="overflow-x:auto;">
                            <table class="articles-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Article</th>
                                        <th>Description</th>
                                        <th>Qté *</th>
                                        <th>Unité *</th>
                                        <th>P.U. HT *</th>
                                        <th>Remise %</th>
                                        <th>Sous-total HT</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="articles-body"></tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="7" style="text-align:right; font-weight:600;">Total articles HT</td>
                                        <td style="font-weight:700; color:#111827;" id="articles-total-ht">0 XAF</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        <div class="totals-strip">
                            <div>
                                <div class="label">Total articles HT</div>
                                <div class="value" id="total-articles-label">0 XAF</div>
                            </div>
                            <div>
                                <div class="label">TVA (19.25%)</div>
                                <div class="value" id="total-vat-label">0 XAF</div>
                            </div>
                            <div>
                                <div class="label">Total TTC</div>
                                <div class="value" id="total-ttc-label">0 XAF</div>
                            </div>
                            <div>
                                <div class="label">Remise cumulée</div>
                                <div class="value" id="total-discount-label">0 XAF</div>
                            </div>
                        </div>
                    </div>

                    <div class="section-grid two-cols">
                        <div class="section-card">
                            <div class="section-title">
                                <i class="fa-solid fa-truck-fast text-[#263c89]"></i>
                                Livraison
                            </div>
                            <div class="data-grid">
                                <div class="data-field">
                                    <label>Date livraison souhaitée *</label>
                                    <input type="date" id="delivery-date">
                                </div>
                                <div class="data-field">
                                    <label>Délai fournisseur</label>
                                    <input type="text" id="delivery-leadtime" readonly>
                                </div>
                                <div class="data-field" style="grid-column: span 2;">
                                    <label>Lieu de livraison *</label>
                                    <select id="delivery-location"></select>
                                </div>
                                <div class="data-field" style="grid-column: span 2;">
                                    <label>Adresse complète</label>
                                    <textarea id="delivery-address"></textarea>
                                </div>
                                <div class="data-field">
                                    <label>Contact réception</label>
                                    <input type="text" id="delivery-contact">
                                </div>
                                <div class="data-field">
                                    <label>Incoterm *</label>
                                    <select id="delivery-incoterm"></select>
                                </div>
                                <div class="data-field">
                                    <label>Transport</label>
                                    <select id="transport-mode"></select>
                                </div>
                                <div class="data-field">
                                    <label>Transporteur prévu</label>
                                    <select id="carrier-select"></select>
                                </div>
                            </div>
                        </div>

                        <div class="section-card">
                            <div class="section-title">
                                <i class="fa-solid fa-money-check-dollar text-[#263c89]"></i>
                                Paiement
                            </div>
                            <div class="data-grid">
                                <div class="data-field">
                                    <label>Conditions *</label>
                                    <select id="payment-terms"></select>
                                </div>
                                <div class="data-field">
                                    <label>Mode paiement *</label>
                                    <select id="payment-mode"></select>
                                </div>
                                <div class="data-field">
                                    <label>Devise</label>
                                    <select id="currency-select">
                                        <option value="XAF">XAF</option>
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                    </select>
                                </div>
                                <div class="data-field">
                                    <label>Taux change</label>
                                    <input type="number" id="exchange-rate" step="0.001">
                                </div>
                            </div>
                            <div class="data-field">
                                <label>Escompte</label>
                                <div style="display:flex; align-items:center; gap:12px;">
                                    <input type="checkbox" id="early-payment-checkbox">
                                    <span>2% si paiement < 10 jours (<strong id="early-payment-value">0 XAF</strong>)</span>
                                </div>
                            </div>
                            <div class="alert-direct" style="background:#DBEAFE; border-color:#93C5FD; color:#1D4ED8;">
                                <i class="fa-solid fa-scale-balanced text-[#2563EB]"></i>
                                <div>
                                    <strong>Conformité Cameroun / CEMAC</strong>
                                    <p style="margin:6px 0 0; font-size:13px;">Espèces plafonnées 5M XAF • Mobile Money 1M XAF • Certificat non-redevance obligatoire.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-title">
                            <i class="fa-solid fa-calculator text-[#263c89]"></i>
                            Frais annexes & calcul TVA
                        </div>
                        <div class="fees-grid">
                            <div class="data-field">
                                <label>Transport *</label>
                                <input type="number" id="fee-transport" min="0">
                            </div>
                            <div class="data-field">
                                <label>Assurance</label>
                                <input type="number" id="fee-insurance" min="0">
                            </div>
                            <div class="data-field">
                                <label>Douane</label>
                                <input type="number" id="fee-customs" min="0">
                            </div>
                            <div class="data-field">
                                <label>Manutention</label>
                                <input type="number" id="fee-handling" min="0">
                            </div>
                            <div class="data-field">
                                <label>Autres</label>
                                <input type="number" id="fee-other" min="0">
                            </div>
                            <div class="data-field">
                                <label>Libellé autres</label>
                                <input type="text" id="fee-other-label" placeholder="Préciser">
                            </div>
                        </div>
                        <div class="totals-strip" style="margin-top:20px;">
                            <div>
                                <div class="label">Base HT (Articles)</div>
                                <div class="value" id="base-articles">0 XAF</div>
                            </div>
                            <div>
                                <div class="label">Base HT (Frais)</div>
                                <div class="value" id="base-fees">0 XAF</div>
                            </div>
                            <div>
                                <div class="label">Total HT</div>
                                <div class="value" id="total-ht">0 XAF</div>
                            </div>
                            <div>
                                <div class="label">TVA 19.25%</div>
                                <div class="value" id="total-tva">0 XAF</div>
                            </div>
                            <div>
                                <div class="label">Total TTC</div>
                                <div class="value" id="total-ttc">0 XAF</div>
                            </div>
                        </div>
                        <div style="margin-top:12px; font-size:13px;">
                            Montant en lettres: <strong id="amount-in-words">-</strong>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-title">
                            <i class="fa-solid fa-wallet text-[#263c89]"></i>
                            Contrôle budgétaire
                        </div>
                        <div class="data-grid">
                            <div class="data-field">
                                <label>Ligne budgétaire *</label>
                                <select id="budget-line"></select>
                            </div>
                            <div class="data-field">
                                <label>Exercice</label>
                                <input type="number" id="budget-year" readonly>
                            </div>
                            <div class="data-field">
                                <label>Période</label>
                                <input type="text" id="budget-period" readonly>
                            </div>
                        </div>
                        <div class="budget-box">
                            <div class="row"><span>Budget alloué</span><strong id="budget-allocated">0 XAF</strong></div>
                            <div class="row"><span>Consommé à date</span><strong id="budget-consumed">0 XAF</strong></div>
                            <div class="row"><span>Engagé (autres BCF)</span><strong id="budget-committed">0 XAF</strong></div>
                            <div class="row"><span>Disponible</span><strong id="budget-available">0 XAF</strong></div>
                            <div class="row"><span>Cette commande (HT Art.)</span><strong id="budget-this-order">0 XAF</strong></div>
                            <div class="row" style="border-top:1px solid #E5E7EB; padding-top:8px;"><span>Solde après</span><strong id="budget-remaining">0 XAF</strong></div>
                            <div class="budget-progress"><div class="bar" id="budget-progress-bar" style="width:45%;"></div></div>
                            <div class="status-chip pending" id="budget-status">Budget disponible</div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-title">
                            <i class="fa-solid fa-paperclip text-[#263c89]"></i>
                            Documents & pièces jointes
                        </div>
                        <div class="documents-list" id="documents-required"></div>
                        <div class="notes-grid" style="margin-top:16px;">
                            <div class="data-field">
                                <label>Instructions fournisseur</label>
                                <textarea id="supplier-notes"></textarea>
                            </div>
                            <div class="data-field">
                                <label>Notes internes</label>
                                <textarea id="internal-notes"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-title">
                            <i class="fa-solid fa-diagram-project text-[#263c89]"></i>
                            Workflow de validation
                        </div>
                        <div style="display:flex; flex-wrap:wrap; gap:16px; margin-bottom:16px;">
                            <div class="status-pill pill-warning"> montant TTC <span id="workflow-amount">0 XAF</span></div>
                            <div class="status-pill pill-danger" id="workflow-direct-flag">Création directe → validation supplémentaire</div>
                            <div class="status-pill pill-success" id="workflow-sla">Urgence: délai 4h</div>
                        </div>
                        <table class="workflow-table" id="workflow-steps"></table>
                    </div>

                    <div class="section-card mapping-block">
                        <div class="section-title">
                            <i class="fa-solid fa-database text-[#263c89]"></i>
                            Mapping <code>purchase_orders</code>
                        </div>
                        <pre id="mapping-json">{}</pre>
                    </div>

                    <div class="section-card recap-card">
                        <div class="section-title">
                            <i class="fa-solid fa-clipboard-check text-[#263c89]"></i>
                            Récapitulatif & actions
                        </div>
                        <div class="recap-list">
                            <div class="recap-item">
                                <strong>Type</strong>
                                <p id="recap-type">-</p>
                            </div>
                            <div class="recap-item">
                                <strong>Fournisseur</strong>
                                <p id="recap-supplier">-</p>
                            </div>
                            <div class="recap-item">
                                <strong>Livraison</strong>
                                <p id="recap-delivery">-</p>
                            </div>
                            <div class="recap-item">
                                <strong>Budget</strong>
                                <p id="recap-budget">-</p>
                            </div>
                            <div class="recap-item">
                                <strong>Total TTC</strong>
                                <p id="recap-total">-</p>
                            </div>
                            <div class="recap-item">
                                <strong>Points d'attention</strong>
                                <ul id="recap-warnings" style="padding-left:18px; margin:8px 0 0; font-size:13px;"></ul>
                            </div>
                        </div>
                        <div class="actions-bar">
                            <button class="btn-outline" onclick="handleSaveDraft()"><i class="fa-solid fa-floppy-disk"></i> Enregistrer brouillon</button>
                            <button class="btn-primary" onclick="handleSubmitValidation()"><i class="fa-solid fa-paper-plane"></i> Soumettre validation</button>
                            <button class="btn-outline" onclick="handleCancelDraft()"><i class="fa-solid fa-xmark"></i> Annuler</button>
                        </div>
                        <div class="actions-after">
                            <strong>Actions après validation complète</strong>
                            <ul id="post-validation-actions"></ul>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="./js/commande-directe-create.js"></script>
</body>
</html>
